/*
Copyright 2013, KISSY UI Library v1.40dev
MIT Licensed
build time: Apr 17 00:23
*/
KISSY.add("tree/base",function(g,c,e,d,b){return e.extend([b],{},{ATTRS:{xrender:{value:d},defaultChildCfg:{value:{xclass:"tree-node"}}}},{xclass:"tree",priority:30})},{requires:["component/base","./node","./tree-render","./tree-manager"]});
KISSY.add("tree/check-node-render",function(g,c,e){var d=c.all;return e.extend({createDom:function(){var b=this.get("expandIconEl");this.setInternal("checkIconEl",d("<div>").insertAfter(b))},_onSetCheckState:function(b){this.get("checkIconEl").removeClass(this.getCssClassWithPrefix("tree-node-checked0 tree-node-checked1 tree-node-checked2")).addClass(this.getCssClassWithPrefix("tree-node-checked")+b)}},{ATTRS:{checkIconEl:{},checkState:{value:0}}})},{requires:["node","./node-render"]});
KISSY.add("tree/check-node",function(g,c,e,d){var b=c.all,c=e.extend({performActionInternal:function(c){var a;a=this.get("expanded");var j=this.get("expandIconEl"),g=this.get("tree"),c=b(c.target);g.focus();c.equals(j)?this.set("expanded",!a):(a=this.get("checkState"),this.set("checkState",1==a?0:1),this.fire("click"))},_onSetCheckState:function(b){var a=this.get("parent"),c,e,d,h;(1==b||0==b)&&g.each(this.get("children"),function(a){a.set("checkState",b)});if(a){c=0;h=a.get("children");for(e=0;e<
h.length;e++){d=h[e];d=d.get("checkState");if(2==d){a.set("checkState",2);return}1==d&&c++}0===c?a.set("checkState",0):c==h.length?a.set("checkState",1):a.set("checkState",2)}}},{ATTRS:{checkIconEl:{view:1},checkState:{view:1},xrender:{value:d},defaultChildCfg:{value:{xclass:"check-tree-node"}}}},{xclass:"check-tree-node",priority:20});g.mix(c,{PARTIAL_CHECK:2,CHECK:1,EMPTY:0});return c},{requires:["node","./node","./check-node-render"]});
KISSY.add("tree/check-tree-render",function(g,c,e){return c.extend([e])},{requires:["./check-node-render","./tree-manager-render"]});KISSY.add("tree/check-tree",function(g,c,e,d,b){return e.extend([b],{},{ATTRS:{xrender:{value:d},defaultChildCfg:{value:{xclass:"check-tree-node"}}}},{xclass:"check-tree",priority:40})},{requires:["component/base","./check-node","./check-tree-render","./tree-manager"]});
KISSY.add("tree/node-render",function(g,c,e){var d=c.all;return e.Render.extend({refreshCss:function(b,c){var a=this.get("expanded"),e=this.get("iconEl"),d,i=this.get("expandIconEl"),h=this.get("childrenEl");c?(a="tree-file-icon",d="tree-expand-icon-{t}"):a?(a="tree-expanded-folder-icon",d="tree-expand-icon-{t}minus"):(a="tree-collapsed-folder-icon",d="tree-expand-icon-{t}plus");e.attr("class",this.getCssClassWithPrefix(a));i.attr("class",this.getCssClassWithPrefix(g.substitute(d,{t:b?"l":"t"})));
h&&h.attr("class",this.getCssClassWithPrefix(b?"tree-lchildren":"tree-children"))},createDom:function(){var b=this.get("el"),c,a,e,m,i=this.get("contentEl");a=d("<div class='"+this.getCssClassWithPrefix("tree-node-row")+"'/>");(c=i.attr("id"))||i.attr("id",c=g.guid("ks-tree-node"));e=d("<div>").appendTo(a);m=d("<div>").appendTo(a);i.appendTo(a);b.attr({role:"tree-node","aria-labelledby":c}).prepend(a);this.setInternal("rowEl",a);this.setInternal("expandIconEl",e);this.setInternal("iconEl",m)},_onSetExpanded:function(b){var c=
this.get("childrenEl");if(c)c[b?"show":"hide"]();this.get("el").attr("aria-expanded",b)},_onSetSelected:function(b){this.get("rowEl")[b?"addClass":"removeClass"](this.getCssClassWithPrefix("tree-node-selected"));this.get("el").attr("aria-selected",b)},_onSetDepth:function(b){this.get("el")[0].setAttribute("aria-level",b)},_onSetTooltip:function(b){this.get("el").attr("title",b)},getContentElement:function(){var b;if(b=this.get("childrenEl"))return b;b=d("<div "+(this.get("expanded")?"":"style='display:none'")+
" role='group'></div>").appendTo(this.get("el"));this.setInternal("childrenEl",b);return b}},{ATTRS:{childrenEl:{},expandIconEl:{},tooltip:{},iconEl:{},expanded:{value:!1},rowEl:{},depth:{},contentEl:{valueFn:function(){return d("<span id='"+g.guid("ks-tree-node")+"' class='"+this.getCssClassWithPrefix("tree-node-content")+"'/>")}},isLeaf:{},selected:{}},HTML_PARSER:{childrenEl:function(b){return b.children("."+this.getCssClassWithPrefix("tree-children"))},contentEl:function(b){return b.children("."+
this.getCssClassWithPrefix("tree-node-content"))},content:function(b){return b.children("."+this.getCssClassWithPrefix("tree-node-content")).html()},isLeaf:function(b){if(b.hasClass(this.getCssClassWithPrefix("tree-node-leaf")))return!0;if(b.hasClass(this.getCssClassWithPrefix("tree-node-folder")))return!1},expanded:function(b){b=b.one("."+this.get("prefixCls")+"tree-children");return!b?!1:"none"!=b.css("display")}}})},{requires:["node","component/base"]});
KISSY.add("tree/node",function(g,c,e,d){function b(f){f.target==this&&o(this,f.component,this.get("depth"),f.index)}function l(f){f.target==this&&(n(this.get("tree"),f.component,"_unRegister"),p(this,f.index))}function a(f){f.target===this&&this.get("el")[0].setAttribute("aria-setsize",this.get("children").length)}function j(f){var a=f.get("parent"),a=(a=a&&a.get("children"))&&a[a.length-1];return!a||a==f}function m(f){var a=f.get("isLeaf");return!(!1===a||void 0===a&&f.get("children").length)}function i(f){var a=
f.get("children");return!f.get("expanded")||!a.length?f:i(a[a.length-1])}function h(f){f.get&&f.get("view")&&f.get("view").refreshCss(j(f),m(f))}function o(f,a,b,c){var e=f.get("tree");e&&(n(e,a,"_register",b+1),p(f,c))}function n(f,a,b,c){f[b](a);void 0!==c&&a.set("depth",c);g.each(a.get("children"),function(a){"number"==typeof c?n(f,a,b,c+1):n(f,a,b)})}function p(a,b){h(a);for(var b=Math.max(0,b-1),c=a.get("children"),e,d=c.length;b<d;b++)e=c[b],h(e),e.get("el")[0].setAttribute("aria-posinset",
b+1)}var r=c.all,k=c.KeyCodes,q=e.Container.extend([e.DecorateChild],{_onSetSelected:function(a,b){var c=this.get("tree");if(!b||!b.byPassSetTreeSelectedItem)c.set("selectedItem",a?this:null)},bindUI:function(){this.on("afterAddChild",b);this.on("afterRemoveChild",l);this.on("afterAddChild afterRemoveChild",a)},syncUI:function(){h(this);a.call(this,{target:this})},_keyNav:function(a){var b=!0,c=this.get("tree"),e=this.get("expanded"),d,g=this.get("isLeaf"),j=this.get("children");switch(a.keyCode){case k.HOME:d=
c;break;case k.END:d=i(c);break;case k.UP:d=a=(a=this.prev())?i(a):this.get("parent");break;case k.DOWN:a=this.get("children");if(this.get("expanded")&&a.length)d=a[0];else{a=this.next();for(c=this;!a&&(c=c.get("parent"));)a=c.next();d=a}break;case k.LEFT:e&&(j.length||!1===g)?this.set("expanded",!1):d=this.get("parent");break;case k.RIGHT:if(j.length||!1===g)e?d=j[0]:this.set("expanded",!0);break;default:b=!1}d&&d.select();return b},next:function(){var a=this.get("parent"),b;if(!a)return null;a=
a.get("children");b=g.indexOf(this,a);return b==a.length-1?null:a[b+1]},prev:function(){var a=this.get("parent"),b;if(!a)return null;a=a.get("children");b=g.indexOf(this,a);return 0===b?null:a[b-1]},select:function(){this.set("selected",!0)},performActionInternal:function(a){var a=r(a.target),b=this.get("expanded");this.get("tree").focus();a.equals(this.get("expandIconEl"))?this.set("expanded",!b):(this.select(),this.fire("click"))},renderChildren:function(){q.superclass.renderChildren.apply(this,
arguments);this===this.get("tree")&&o(this,this,-1,0)},_onSetExpanded:function(a){this.get("tree");this.get("rendered")&&(h(this),this.fire(a?"expand":"collapse"))},expandAll:function(){this.set("expanded",!0);g.each(this.get("children"),function(a){a.expandAll()})},collapseAll:function(){this.set("expanded",!1);g.each(this.get("children"),function(a){a.collapseAll()})}},{ATTRS:{delegateChildren:{value:!1},xrender:{value:d},handleMouseEvents:{value:!1},isLeaf:{view:1},expandIconEl:{view:1},iconEl:{view:1},
selected:{view:1},expanded:{view:1},collapsed:{getter:function(){return!this.get("expanded")},setter:function(a){this.set("expanded",!a)}},tooltip:{view:1},tree:{getter:function(){for(var a=this;a&&!a.isTree;)a=a.get("parent");return a}},depth:{view:1},focusable:{value:!1},decorateChildCls:{value:"tree-children"},defaultChildCfg:{value:{xclass:"tree-node"}}}},{xclass:"tree-node",priority:10});return q},{requires:["node","component/base","./node-render"]});
KISSY.add("tree/tree-manager-render",function(g){function c(){}c.ATTRS={showRootNode:{}};g.augment(c,{__renderUI:function(){this.get("el").attr("role","tree");this.get("rowEl").addClass(this.get("prefixCls")+"tree-row")},_onSetShowRootNode:function(c){this.get("rowEl")[c?"show":"hide"]()}});return c});
KISSY.add("tree/tree-manager",function(g,c,e){function d(){}function b(a){var a=a.get("el"),b=a.attr("id");b||a.attr("id",b=g.guid("tree-node"));return b}function l(a){a._allNodes||(a._allNodes={});return a._allNodes}d.ATTRS={delegateChildren:{value:!0},showRootNode:{value:!0,view:1},selectedItem:{},focusable:{value:!0}};g.augment(d,{isTree:1,_register:function(a){a.__isRegisted||(l(this)[b(a)]=a,a.__isRegisted=1)},_unRegister:function(a){a.__isRegisted&&(delete l(this)[b(a)],a.__isRegisted=0)},handleKeyEventInternal:function(a){var b=
this.get("selectedItem");return a.keyCode==c.KeyCodes.ENTER?b.performActionInternal(a):b._keyNav(a)},getOwnerControl:function(a){for(var b,c=l(this),d=this.get("el")[0];a&&a!==d;){if(b=c[a.id])return b;a=a.parentNode}return this},_onSetSelectedItem:function(a,b){a&&b.prevVal&&b.prevVal.set("selected",!1,{data:{byPassSetTreeSelectedItem:1}})},_onSetFocused:function(a){e.Controller.prototype._onSetFocused.apply(this,arguments);a&&!this.get("selectedItem")&&this.select()}});return d},{requires:["event",
"component/base"]});KISSY.add("tree/tree-render",function(g,c,e){return c.extend([e])},{requires:["./node-render","./tree-manager-render"]});KISSY.add("tree",function(g,c,e,d,b){c.Node=e;c.CheckNode=d;c.CheckTree=b;return c},{requires:["tree/base","tree/node","tree/check-node","tree/check-tree"]});
